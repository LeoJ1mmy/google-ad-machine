# Linshibi 廣告替換程式使用手冊

## 🎯 程式功能
- 自動掃描 Linshibi.com 網站廣告
- 將廣告替換為自訂圖片
- 支援多種廣告尺寸 (970x90, 728x90, 300x250, 160x600 等)
- 多螢幕支援功能
- 智能廣告識別和動態廣告處理
- 自動截圖記錄結果
- 專門針對日本旅遊相關內容

## 📦 安裝
```bash
pip install -r requirements.txt
```

## ⚙️ 設定檔案 (config.py)

### 主要設定
```python
SCREENSHOT_COUNT = 30        # 要截圖的張數
NEWS_COUNT = 20             # 要搜尋的新聞數量
HEADLESS_MODE = False       # 是否隱藏瀏覽器視窗
LINSHIBI_BASE_URL = "https://linshibi.com"  # 林氏璧網站
BUTTON_STYLE = "dots"       # 按鈕樣式 (dots/cross/adchoices/adchoices_dots/none)
```

### 廣告尺寸設定
```python
LINSHIBI_TARGET_AD_SIZES = [
    {"width": 970, "height": 90},   # 大橫幅廣告
    {"width": 728, "height": 90},   # 橫幅廣告
    {"width": 300, "height": 250},  # 中矩形廣告
    {"width": 320, "height": 50},   # 手機橫幅
    {"width": 336, "height": 280},  # 大矩形廣告
    {"width": 160, "height": 600},  # 側邊欄廣告
    # 更多尺寸...
]
```

## 🚀 使用方法

### 1. 手動執行程式
```bash
python linshibi_replace.py
```

### 2. 程式會自動：
- 偵測可用螢幕並讓你選擇
- 搜尋 Linshibi.com 文章（按順序獲取）
- 掃描多種廣告尺寸（970x90, 728x90, 300x250, 160x600 等）
- 智能識別 AdSense、Google 展示廣告、Criteo 廣告
- 替換廣告圖片並添加控制按鈕
- 自動滾動到廣告位置並截圖
- 截圖後立即還原廣告內容
- 達到設定數量後停止

## 🖥️ 多螢幕支援

### 螢幕選擇
程式啟動時會自動偵測螢幕：
```
偵測到的螢幕:
螢幕 1: 1920x1080 (主螢幕)
螢幕 2: 1920x1080
請選擇要使用的螢幕 (1-2) [預設: 1]:
```

### 支援系統
- **Windows**: PowerShell、wmic、tkinter 多重偵測
- **macOS**: system_profiler、AppleScript 偵測
- 自動全螢幕顯示

## 📸 替換圖片

### 圖片命名
- 格式：`google_寬度x高度.jpg`
- 範例：`google_160x600.jpg`

### Linshibi 支援尺寸
- **970x90** - 大橫幅廣告
- **728x90** - 橫幅廣告  
- **300x250** - 中矩形廣告
- **320x50** - 手機橫幅
- **336x280** - 大矩形廣告
- **160x600** - 側邊欄廣告
- **120x600** - 窄側邊欄廣告
- **240x400** - 中型廣告
- **250x250** - 正方形廣告
- **300x600** - 大側邊欄廣告
- **320x100** - 手機大橫幅
- **980x120** - 超大橫幅
- 其他常見廣告尺寸

## 🎯 目標網站特色

### Linshibi.com (林氏璧)
- 專業的日本旅遊資訊平台
- 豐富的東京自由行攻略
- 美食、住宿、交通資訊
- 高品質的旅遊攝影和實用建議

### 智能掃描特色
- **多尺寸支援**: 自動掃描所有常見廣告尺寸
- **智能廣告識別**: 自動識別 AdSense、Google 展示廣告、Criteo 廣告
- **動態廣告處理**: 等待動態廣告載入完成
- **精確匹配**: ±2像素容差，適應不同解析度
- **按順序處理**: 按文章發布順序獲取連結
- **避免重複**: 每個廣告位置只處理一次

## 🎨 按鈕樣式設定

### 可用樣式
```python
BUTTON_STYLE = "dots"            # 三點按鈕（預設）
BUTTON_STYLE = "cross"           # 叉叉按鈕
BUTTON_STYLE = "adchoices"       # AdChoices 標準按鈕
BUTTON_STYLE = "adchoices_dots"  # AdChoices + 三點組合
BUTTON_STYLE = "none"            # 無按鈕模式
```

### 按鈕功能
- **關閉按鈕**: 右上角，用於關閉廣告
- **資訊按鈕**: 顯示廣告資訊，符合 Google AdChoices 標準
- **智能定位**: 按鈕會根據廣告類型自動調整位置

## 🔧 調整設定

### 修改截圖數量
```python
# 在 config.py 中改這行
SCREENSHOT_COUNT = 10       # 改為10張
```

### 修改新聞數量
```python
# 在 config.py 中改這行
NEWS_COUNT = 15             # 改為15個
```

### 隱藏瀏覽器視窗
```python
# 在 config.py 中改這行
HEADLESS_MODE = True        # 不顯示瀏覽器
```

### 自訂廣告尺寸
```python
# 在 config.py 中修改支援的廣告尺寸
LINSHIBI_TARGET_AD_SIZES = [
    {"width": 970, "height": 90},   # 大橫幅廣告
    {"width": 728, "height": 90},   # 橫幅廣告
    {"width": 300, "height": 250},  # 中矩形廣告
    {"width": 160, "height": 600},  # 側邊欄廣告
    # 可以添加更多尺寸...
]
```

## 📁 檔案說明

- `linshibi_replace.py` - 主程式
- `config.py` - 設定檔
- `replace_image/` - 替換圖片資料夾
- `screenshots/` - 截圖輸出資料夾

## ❓ 常見問題

### Q: 程式無法啟動？
A: 確認已安裝依賴包：`pip install -r requirements.txt`

### Q: 找不到廣告？
A: 
- 確認 `replace_image/` 資料夾中有對應尺寸的圖片
- 程式會自動等待動態廣告載入
- 檢查網站是否有廣告區塊
- 程式支援多種廣告類型（AdSense、Google 展示廣告、Criteo）

### Q: 螢幕選擇失敗？
A: 
- 程式會自動偵測螢幕，如果失敗會使用預設螢幕
- Windows 用戶確認 PowerShell 可用
- macOS 用戶確認系統權限

### Q: 瀏覽器無法開啟？
A: 確認已安裝 Google Chrome

### Q: 找不到日本旅遊文章？
A: 程式會自動搜尋 Linshibi.com 的文章連結

### Q: 廣告替換失敗？
A: 
- 檢查圖片尺寸是否符合廣告規格
- 確認網站有載入廣告（程式會自動檢測）
- 程式會自動處理多種廣告類型
- 檢查按鈕樣式設定是否正確

## 🌟 特殊功能

### 智能廣告識別系統
- **多類型支援**: 自動識別 AdSense、Google 展示廣告、Criteo 廣告
- **動態載入**: 等待動態廣告載入完成（最多10秒）
- **精確匹配**: ±2像素容差，確保準確替換
- **控制面板過濾**: 自動排除 AdSense 控制面板和隱藏元素

### 按順序文章獲取
程式會智能獲取 Linshibi.com 的文章：
```
� 文章結獲取策略:
1. 優先搜尋 content 區塊內的標題連結
2. 搜尋內容區塊的相關連結  
3. 備用：搜尋整個頁面的連結
4. 自動排除分頁連結（paged= 參數）
5. 識別 ?p= 格式的文章連結
```

### 智能滾動和截圖
- **精確定位**: 自動滾動到廣告位置
- **按鈕可見**: 確保控制按鈕在螢幕上方10%位置
- **多平台截圖**: 支援 macOS (screencapture)、Windows (MSS/pyautogui)
- **立即還原**: 截圖後立即還原廣告內容

### 完整還原機制
- 保存原始廣告內容
- 截圖後自動還原
- 不影響網站正常運作

## 📝 注意事項

1. 需要網路連線
2. 需要 Google Chrome 瀏覽器
3. 圖片建議使用 JPG 格式
4. 程式會自動停止達到目標數量
5. **專門針對 Linshibi.com 網站**
6. **支援多種廣告尺寸和類型**
7. 支援 Ctrl+C 優雅中斷
8. 多螢幕環境下可選擇顯示螢幕
9. 自動按順序獲取文章連結
10. 智能廣告類型識別

## 🎨 截圖命名規則

截圖檔案會自動命名為：
```
linshibi_[文章標題]_[時間戳].png
```

範例：
```
linshibi_東京自由行_林氏璧給新手的十個建議_20250828_143022.png
```

## 🔍 除錯功能

### 智能廣告檢測調試
```
🔍 使用特定選擇器搜尋廣告...
   ✅ 選擇器 'ins.adsbygoogle' 找到 3 個元素
   ✅ 選擇器 'div[id^="aswift_"]' 找到 2 個元素
   ✅ 選擇器 'iframe[id^="aswift_"]' 找到 2 個元素
✅ 找到符合廣告: 300x250 at 150,200 (div, class='adsbygoogle')
```

### 廣告替換驗證
```
📊 替換驗證結果:
   ✅ 替換了 1 個圖片
   ✅ 添加了 2 個控制按鈕
✅ 廣告替換成功！共 1 個元素被替換
```

### 詳細日誌
- 顯示載入的替換圖片清單（所有尺寸）
- 記錄動態廣告載入進度
- 廣告類型識別結果
- 按順序獲取的文章連結
- 滾動和截圖定位資訊
- 螢幕選擇和定位資訊

## 🚀 快速開始

**簡單三步驟：**
1. 修改 `config.py` 設定（特別是 `SCREENSHOT_COUNT` 和 `BUTTON_STYLE`）
2. 執行 `python linshibi_test.py`（正式版本）
3. 選擇螢幕後查看 `screenshots/` 資料夾的結果

**專業提示：**
- Linshibi.com 內容豐富且更新頻繁
- 程式支援多種廣告尺寸，自動識別最佳匹配
- 智能按順序獲取文章，避免重複處理
- 建議在網路流量較低時執行以提高成功率
- 程式支援 Ctrl+C 安全中斷，不會損壞資料
- 多螢幕用戶可以選擇在副螢幕執行，不影響主要工作
- 每個廣告位置只處理一次，提高效率

**版本差異：**
- `linshibi_test.py` - 正式版本，功能完整，推薦使用
- `linshibi_replace.py` - 舊版本，專注 160x600 廣告

---

**版本**：2.0 (linshibi_test.py)  
**目標網站**：https://linshibi.com  
**特色**：多尺寸廣告支援 + 智能廣告識別 + 多螢幕支援