# 通用廣告替換器模組使用說明

## 概述

`base_ad_replacer.py` 是一個通用的廣告替換器基礎模組，包含了所有重複的功能，讓您可以輕鬆為新網站創建廣告替換器。

## 主要功能

### 1. 基礎功能 (BaseAdReplacer)
- ✅ **瀏覽器設置**：自動配置 Chrome 驅動
- ✅ **圖片載入**：自動載入 replace_image 資料夾中的圖片
- ✅ **按鈕樣式**：支援 4 種按鈕樣式 (dots, cross, adchoices, adchoices_dots)
- ✅ **廣告替換**：統一的廣告替換邏輯
- ✅ **截圖功能**：自動截圖並加入頁面標題
- ✅ **還原功能**：簡化的廣告還原邏輯
- ✅ **位置記憶**：避免重複處理同一位置

### 2. 需要實作的方法
每個新網站只需要實作以下兩個方法：

#### `get_random_news_urls(self, base_url, count=5)`
- **功能**：獲取該網站的新聞連結
- **參數**：
  - `base_url`：網站首頁 URL
  - `count`：需要獲取的連結數量
- **返回**：新聞連結列表

#### `scan_entire_page_for_ads(self, target_width, target_height)`
- **功能**：掃描網頁尋找符合尺寸的廣告
- **參數**：
  - `target_width`：目標廣告寬度
  - `target_height`：目標廣告高度
- **返回**：符合條件的廣告元素列表

## 使用方法

### 1. 創建新網站的廣告替換器

```python
from base_ad_replacer import BaseAdReplacer

class NewSiteAdReplacer(BaseAdReplacer):
    """新網站廣告替換器"""
    
    def __init__(self, headless=False):
        super().__init__(headless, site_prefix="newsite")  # 設定截圖檔案名前綴
    
    def get_random_news_urls(self, base_url, count=5):
        """獲取新網站的新聞連結"""
        # 實作獲取新聞連結的邏輯
        pass
    
    def scan_entire_page_for_ads(self, target_width, target_height):
        """掃描新網站的廣告"""
        # 實作掃描廣告的邏輯
        pass
```

### 2. 範例：自由時報

```python
class LtnAdReplacer(BaseAdReplacer):
    def __init__(self, headless=False):
        super().__init__(headless, site_prefix="ltn")
    
    def get_random_news_urls(self, base_url, count=5):
        # 使用 CSS 選擇器獲取新聞連結
        link_selectors = [
            'a[href*="/article/"]',
            'a[href*="/news/"]',
            # ... 更多選擇器
        ]
        # 實作邏輯...
    
    def scan_entire_page_for_ads(self, target_width, target_height):
        # 掃描所有可見元素
        # 檢查尺寸匹配
        # 驗證是否為廣告
        # 實作邏輯...
```

### 3. 範例：Yahoo 新聞

```python
class YahooAdReplacer(BaseAdReplacer):
    def __init__(self, headless=False):
        super().__init__(headless, site_prefix="yahoo")
    
    def get_random_news_urls(self, base_url, count=5):
        # Yahoo 特定的新聞連結獲取邏輯
        pass
    
    def scan_entire_page_for_ads(self, target_width, target_height):
        # Yahoo 特定的廣告掃描邏輯
        pass
```

## 配置設定

### config.py 設定
```python
# 按鈕樣式設定
BUTTON_STYLE = "adchoices_dots"  # 可選: "dots", "cross", "adchoices", "adchoices_dots"

# 截圖設定
SCREENSHOT_COUNT = 30
SCREENSHOT_FOLDER = "screenshots"

# 網站設定
BASE_URL = "https://your-site.com"
NEWS_COUNT = 20
```

## 檔案結構

```
project/
├── base_ad_replacer.py          # 基礎模組
├── config.py                    # 設定檔
├── ad_replacer_new.py          # 自由時報 (新版本)
├── yahoo_replace_new.py        # Yahoo 新聞 (新版本)
├── udn_replace_new.py          # 聯合報 (新版本)
├── replace_image/              # 替換圖片資料夾
├── screenshots/                # 截圖輸出資料夾
└── 通用模組使用說明.md         # 本說明文件
```

## 優勢

### 1. 代碼重用
- 所有通用功能都在基礎模組中
- 新網站只需要實作 2 個方法
- 減少重複代碼

### 2. 統一功能
- 統一的截圖命名格式
- 統一的還原邏輯
- 統一的按鈕樣式

### 3. 易於維護
- 功能修改只需要改基礎模組
- 所有網站自動獲得新功能
- 清晰的代碼結構

### 4. 快速開發
- 新網站開發時間大幅縮短
- 只需要專注於網站特定的邏輯
- 減少錯誤和調試時間

## 遷移指南

### 從舊版本遷移到新版本

1. **創建新的類別**：
   ```python
   from base_ad_replacer import BaseAdReplacer
   
   class YourSiteAdReplacer(BaseAdReplacer):
       def __init__(self, headless=False):
           super().__init__(headless, site_prefix="yoursite")
   ```

2. **實作必要方法**：
   - 複製 `get_random_news_urls` 方法
   - 複製 `scan_entire_page_for_ads` 方法

3. **移除重複代碼**：
   - 刪除重複的截圖、還原、按鈕等代碼
   - 保留網站特定的邏輯

4. **測試新版本**：
   - 確保功能正常運作
   - 檢查截圖命名格式
   - 驗證還原功能

## 注意事項

1. **網站特定邏輯**：每個網站的廣告結構可能不同，需要調整掃描邏輯
2. **選擇器更新**：網站結構變化時需要更新 CSS 選擇器
3. **錯誤處理**：建議加入適當的錯誤處理機制
4. **效能優化**：對於大型網站，可能需要優化掃描效能

## 支援的網站類型

- ✅ 新聞網站
- ✅ 部落格網站
- ✅ 內容網站
- ✅ 任何包含廣告的網站

## 未來擴展

- 🔄 支援更多按鈕樣式
- 🔄 自動廣告識別
- 🔄 多網站並行處理
- 🔄 更智能的還原機制 